<!doctype html><html>
<head>
<title>
Flashing Nanostation M5 with NYC Mesh Firmware - Tucson Mesh Docs
</title><meta name=viewport content="width=device-width,initial-scale=1">
<link href=../../css/main.css rel=stylesheet>
<meta property="og:title" content="Flashing Nanostation M5 with NYC Mesh Firmware - Tucson Mesh Docs">
<meta property="og:type" content="article">
<meta property="article:published_time" content="0001-01-01">
<meta property="og:description" content>
<meta property="og:url" content="https://mackncheesiest.github.io/tucsonmesh-docs/software/nsm5-flash/">
<meta property="og:site_name" content="Tucson Mesh Docs">
<meta property="twitter:description" content>
<meta property="twitter:title" content="Flashing Nanostation M5 with NYC Mesh Firmware - Tucson Mesh Docs">
</head><body class=sans-serif>
<div class="h-100 flex-ns">
<div id=sidebar class="relative ph4-l ph3 flex justify-end-ns br bg-near-white b--light-gray">
<div class="mw5 w-100 overflow-y-hidden flex flex-column">
<div class="nowrap flex items-center justify-start h3">
<a href=../../ title=Home class="f3-ns f4 fw7 black nowrap flex items-center">
<img src=../../img/logo.svg class="h2 mr2">
<span class=f4>NYC Mesh
<span class="ml1 blue f5 ttu">Docs</span></span>
</a>
</div><div role=button class="hideDropdown h3 w3 flex items-center justify-center" tabindex=0><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
</div><div role=button class="showDropdown bg-near-white h3 w3 flex items-center justify-center" tabindex=0><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</div><div class="dn db-ns dropdown overflow-y-auto pbv4-ns mt4-ns">
<ul class="list ma0 ph0">
<li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/intro/ class="db black">Introduction</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/hardware/ class="db black">Hardware</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/firmware/ class="db black">Firmware</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/diy/ class="db black">DIY & Troubleshooting</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/glossary/ class="db black">Glossary</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/installs/ class="db black">Installs</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/networking/ class="db black">Networking</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/nodes/ class="db black">Nodes</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/organization/ class="db black">Organization</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/security/ class="db black">Security</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/services/ class="db black">Services</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 10 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M5 11 0 6l1.5-1.5L5 8.25 8.5 4.5 10 6z"/></svg>
<a href=../../tucsonmesh-docs/software/ class="db black">Software</a>
</div><ul class="ma0 pa0 ml3 pl2">
<a href=../../tucsonmesh-docs/software/nsm5-flash/ class="db mv3 ml0 gray blue fw5">
Flashing Nanostation M5 with NYC Mesh Firmware
</a>
<a href=../../tucsonmesh-docs/software/watchdog/ class="db mv3 ml0 gray">
Watchdog
</a>
</ul></li></ul></div></div></div><div class="overflow-y-scroll-ns w-80-ns">
<header class="dn ph4 h3 flex-ns flex-row items-center justify-start-l justify-center sans-serif bg-white">
<div class="w-100-ns f4 measure-wide flex items-center justify-end">
<nav class="f5 flex flex-wrap justify-center">
<a href=https://nycmesh.net/ class="f5 blue">Main Site â†’</a>
</nav></div></header><main class="bg-white bt bw05 b--light-gray sans-serif flex flex-row-l flex-column">
<div class="bg-white w-100 pa4-ns pa3">
<div class=f4>
<div class="flex items-center justify-between">
<h1 class=mv0>
Flashing Nanostation M5 with NYC Mesh Firmware
</h1><a class="nowrap pl2" target=_ href=https://github.com/nycmeshnet/docs/blob/master/content/software/nsm5-flash.md>
<div class="ba b--light-gray br2 pa2 f6 fw5 black flex"><svg class="mr1 h1 db-ns dn" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
<span>Edit<span class="dn di-ns pre"> on GitHub</span></span>
</div></a>
</div><div class=f5>
<div class=f6>
<p>
Last updated
May 4, 2019 by Brian
</p></div><p>We have been moving towards MikroTik OmniTik as our mesh device. Before using a NanoStation, you should check with us that you are in range of another NanoStation. Some use the NanoStation when they are out of range of the mesh network using the built-in tinc vpn connection.</p><p>Don&rsquo;t forget to read our <a href=https://nycmesh.net/faq>FAQ</a> on the main site.<br>
Also, please fill out the <a href=https://nycmesh.net/join>Join</a> form.</p><p>When finished, read how to <a href=../../howto/nsm5-install/>install a NanoStation outdoors</a></p><p><strong>Order a router</strong></p><ul>
<li>Ubiquiti NSM5 directional 5GHz (~$90 including tax)</li></ul><p><strong>For Supernode connections you need a different router (usually LiteBeamAC)</strong></p><p>Buy on Amazon:<br>
<a href="http://www.amazon.com/dp/B0049AVWAO?tag=nycmesh-20">Ubiquiti NanoStation NSM5</a></p><p>Buy at B&H: (free delivery)<br>
<a href=http://www.bhphotovideo.com/c/product/1049768-REG/>Ubiquiti NanoStation NSM5</a></p><p><strong>Download the firmware and flash your router</strong></p><p><strong>NanoStation NSM5 instructions</strong><br>
(for old NSM5s or if you are upgrading see below)</p><p>FOLLOW ALL THE STEPS OR YOU MAY PERMANENTLY BRICK THE ROUTER!</p><ul>
<li>For a new NSM5, download this file to your computer- <a href=http://dl.ubnt.com/firmwares/XW-fw/v5.5.10/XW.v5.5.10-u2.28005.150723.1358.bin>AirOS5.5 download</a> <strong>You MUST downgrade from AirOS 5.6 to 5.5</strong></li><li>Plug an ethernet cable from POE on the power adapter to &ldquo;main&rdquo; on the NSM5 (we will switch to &ldquo;secondary&rdquo; later)</li><li>Plug from LAN on the adapter to your computer (You may need a USB ethernet adapter)</li><li>Turn off Wi-Fi on your computer</li><li>Open Network Prefs (or equivalent)</li><li>Connect by ethernet using a manual address e.g. 192.168.1.11 with mask 255.255.255.0</li><li>Go to <a href=http://192.168.1.20>192.168.1.20</a> in your browser</li><li>You will get https warning &ldquo;your connection is not private&rdquo; or some such</li><li>Click &ldquo;advanced&rdquo; and &ldquo;proceed to 192.168.1.20&rdquo;</li><li>Enter ubnt, ubnt, USA, <input checked disabled type=checkbox> agree to terms, login</li><li>On the tabbed panel select &ldquo;System&rdquo;</li><li>Click &ldquo;Upload Firmware: Choose File&rdquo;</li><li>Select the AirOS file</li><li>Click &ldquo;Upload&rdquo;</li><li>There are two loading screens here, and if you don&rsquo;t go through both, you will irreparably break the router.</li><li>Wait until it reboots</li><li>Make sure you are now running 5.5.10 and NOT 5.6.x. Seriously. Read this. Double check. Triple check. If not, you&rsquo;ll break the router.</li><li>Download our firmware- <a href=http://nycmesh.net/download/NSM5-XW.html>NSM5 XW download</a></li><li>Go to <a href=http://192.168.1.20>192.168.1.20</a>, login and select &ldquo;System&rdquo; again</li><li>Click &ldquo;Upload Firmware: Choose File&rdquo;</li><li>Select the M5-XW factory image you downloaded</li><li>Click &ldquo;Upload&rdquo;</li><li>You will get a &ldquo;third-party&rdquo; warning. Ignore this and click &ldquo;Update&rdquo;</li></ul><p>Wait ten minutes or so. It now has a SSID name like &ldquo;nycmesh 1a2b&rdquo; and a random IP of the form 10.x.x.x</p><ul>
<li>
<p>Plug an ethernet cable from LAN on your current router to LAN on the power supply, and from POE to the <strong>secondary</strong> input on the NanoStation.</p></li><li>
<p><a htag=mailto:newnode@nycmesh.net>Email us</a> and we will check that everything is working and add you to the mesh. You must do this as we manually configure the tinc tunneling for each newly flashed router.</p></li></ul><p><strong>You must also install a watchdog script to keep the network stable</strong>. <a href=../../howto/watchdog>Here are the instructions</a>. <a htag=mailto:newnode@nycmesh.net>Email us</a> if you are not comfortable doing this. This script will be included in the next version of our firmware.</p><p>You&rsquo;re done!
Now your router is flashed, read how to <a href=../../howto/nsm5-install/>install a NanoStation</a></p><p><strong>Upgrades</strong><br>
Upgrades are for when your router is already running nycmesh/qMp or another version of OpenWrt.</p><p><a href=http://nycmeshnet.github.io/download/WR842N-upgrade.html>WR842N upgrade download</a><br>
<a href=http://nycmeshnet.github.io/download/WDR3600-upgrade.html>WDR3600 upgrade download</a><br>
<a href=http://nycmeshnet.github.io/download/NSM5-XW-upgrade.html>NSM5-XW upgrade download</a></p><p><strong>Older (2014 or earlier) XM NSM5s</strong><br>
<a href=http://nycmeshnet.github.io/download/NSM5-XM.html>NSM5-XM download</a><br>
<a href=http://nycmeshnet.github.io/download/NSM5-XM-upgrade.html>NSM5-XM upgrade download</a></p><p><strong>Firmware</strong><br>
<a href=https://github.com/nycmeshnet>Our firmware</a> is based on <a href=http://qmp.cat/>qMp</a>, which is an <a href=https://openwrt.org/>OpenWrt</a> package using <a href=http://bmx6.net/projects/bmx6>BMX6</a> meshing protocol. Thanks to Roger at qMp for all of his help.</p><p><strong>Am I on the mesh?</strong></p><p>After you successfully flash your router and you have <a htag=mailto:newnode@nycmesh.net>emailed us</a>, and we have added your tinc tunneling key, you should be on the mesh. If you re-flash your router (not usually necessary) you will have to email us again so we can add your new tinc tunneling key. Emailing us also lets us know who&rsquo;s router was just flashed.</p><p>A quick test to see if you are on the mesh is to go here-
<a href=http://10.100.4.10/>http://10.100.4.10/</a></p><p>This URL should resolve after an hour or so of being online-<br>
<a href=http://wiki.mesh/>http://wiki.mesh/</a></p><p>Here are our old TP-Link instructions in case you find an old TL-WR842N on ebay-</p><p><strong>TP-Link instructions</strong></p><ul>
<li>Click to download the firmware to your computer-<br>
<a href=http://nycmeshnet.github.io/download/WR842N.html>TL-WR842N download</a>
(For upgrades see above)</li><li>Connect to the router via Wi-Fi. It has a name like &ldquo;TP-LINK_ABC123&rdquo;</li><li>Enter the &ldquo;wireless password/pin&rdquo; that is printed on the bottom of the router e.g. &ldquo;12341234&rdquo;</li><li>In your browser, go to 192.168.0.1</li><li>Enter name: admin, pwd: admin</li><li>Click System Tools>Firmware upgrade</li><li>Click &ldquo;choose file&rdquo; and select the image you downloaded and click &ldquo;upgrade&rdquo;</li></ul><p>Wait ten minutes or so and connect to the router via Wi-Fi. It now has a SSID name like &ldquo;nycmesh 1a2b&rdquo; and a random IP of the form 10.x.x.x</p><ul>
<li>
<p>Plug an ethernet cable from LAN on your current router to the blue WAN on the TP-Link.</p></li><li>
<p><a htag=mailto:contact@nycmesh.net>Email us</a> and we will check that everything is working.</p></li></ul></div></div></div></main></div></div></body></html>