<!doctype html><html>
<head>
<title>
Ubiquiti EdgePoint R6 - Tucson Mesh Docs
</title><meta name=viewport content="width=device-width,initial-scale=1">
<link href=../../css/main.css rel=stylesheet>
<meta property="og:title" content="Ubiquiti EdgePoint R6 - Tucson Mesh Docs">
<meta property="og:type" content="article">
<meta property="article:published_time" content="0001-01-01">
<meta property="og:description" content>
<meta property="og:url" content="https://mackncheesiest.github.io/tucsonmesh-docs/hardware/epr6/">
<meta property="og:site_name" content="Tucson Mesh Docs">
<meta property="twitter:description" content>
<meta property="twitter:title" content="Ubiquiti EdgePoint R6 - Tucson Mesh Docs">
</head><body class=sans-serif>
<div class="h-100 flex-ns">
<div id=sidebar class="relative ph4-l ph3 flex justify-end-ns br bg-near-white b--light-gray">
<div class="mw5 w-100 overflow-y-hidden flex flex-column">
<div class="nowrap flex items-center justify-start h3">
<a href=../../ title=Home class="f3-ns f4 fw7 black nowrap flex items-center">
<img src=../../img/logo.svg class="h2 mr2">
<span class=f4>NYC Mesh
<span class="ml1 blue f5 ttu">Docs</span></span>
</a>
</div><div role=button class="hideDropdown h3 w3 flex items-center justify-center" tabindex=0><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
</div><div role=button class="showDropdown bg-near-white h3 w3 flex items-center justify-center" tabindex=0><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</div><div class="dn db-ns dropdown overflow-y-auto pbv4-ns mt4-ns">
<ul class="list ma0 ph0">
<li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/intro/ class="db black">Introduction</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 10 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M5 11 0 6l1.5-1.5L5 8.25 8.5 4.5 10 6z"/></svg>
<a href=../../tucsonmesh-docs/hardware/ class="db black">Hardware</a>
</div><ul class="ma0 pa0 ml3 pl2">
<a href=../../tucsonmesh-docs/hardware/config/ class="db mv3 ml0 gray">
Configs
</a>
<a href=../../tucsonmesh-docs/hardware/60ghz/ class="db mv3 ml0 gray">
60 GHz
</a>
<a href=../../tucsonmesh-docs/hardware/chromebook/ class="db mv3 ml0 gray">
Chromebook
</a>
<a href=../../tucsonmesh-docs/hardware/ethernet/ class="db mv3 ml0 gray">
Ethernet
</a>
<a href=../../tucsonmesh-docs/hardware/mikrotiknetpower15fr/ class="db mv3 ml0 gray">
MikroTik NetPower 15FR
</a>
<a href=../../tucsonmesh-docs/hardware/mikrotikomnitik5ac/ class="db mv3 ml0 gray">
MikroTik OmniTik 5 POE ac
</a>
<a href=../../tucsonmesh-docs/hardware/mikrotikpowerboxpro/ class="db mv3 ml0 gray">
MikroTik PowerBox Pro
</a>
<a href=../../tucsonmesh-docs/hardware/mikrotikspecifics/ class="db mv3 ml0 gray">
MikroTik Specifics
</a>
<a href=../../tucsonmesh-docs/hardware/sxtsqg5acd/ class="db mv3 ml0 gray">
Mikrotik SXTsq G-5acD
</a>
<a href=../../tucsonmesh-docs/hardware/newhardware/ class="db mv3 ml0 gray">
New Hardware
</a>
<a href=../../tucsonmesh-docs/hardware/tplink/ class="db mv3 ml0 gray">
TP-Link Indoor Router
</a>
<a href=../../tucsonmesh-docs/hardware/ltu/ class="db mv3 ml0 gray">
Try the new LTU sector
</a>
<a href=../../tucsonmesh-docs/hardware/epr6/ class="db mv3 ml0 gray blue fw5">
Ubiquiti EdgePoint R6
</a>
<a href=../../tucsonmesh-docs/hardware/liteap/ class="db mv3 ml0 gray">
Ubiquiti LiteAP Sector
</a>
<a href=../../tucsonmesh-docs/hardware/litebeamac/ class="db mv3 ml0 gray">
Ubiquiti LiteBeam AC
</a>
<a href=../../tucsonmesh-docs/hardware/nsm5/ class="db mv3 ml0 gray">
Ubiquiti Nanostation M5
</a>
<a href=../../tucsonmesh-docs/hardware/unifi-ap/ class="db mv3 ml0 gray">
Unifi Access Points
</a>
</ul></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/firmware/ class="db black">Firmware</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/diy/ class="db black">DIY & Troubleshooting</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/glossary/ class="db black">Glossary</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/installs/ class="db black">Installs</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/networking/ class="db black">Networking</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/nodes/ class="db black">Nodes</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/organization/ class="db black">Organization</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/security/ class="db black">Security</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/services/ class="db black">Services</a>
</div></li><li>
<div class="flex items-center pv2"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" viewBox="0 0 8 16" fill="#ccc" class="red mr2"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3z"/></svg>
<a href=../../tucsonmesh-docs/software/ class="db black">Software</a>
</div></li></ul></div></div></div><div class="overflow-y-scroll-ns w-80-ns">
<header class="dn ph4 h3 flex-ns flex-row items-center justify-start-l justify-center sans-serif bg-white">
<div class="w-100-ns f4 measure-wide flex items-center justify-end">
<nav class="f5 flex flex-wrap justify-center">
<a href=https://nycmesh.net/ class="f5 blue">Main Site â†’</a>
</nav></div></header><main class="bg-white bt bw05 b--light-gray sans-serif flex flex-row-l flex-column">
<div class="bg-white w-100 pa4-ns pa3">
<div class=f4>
<div class="flex items-center justify-between">
<h1 class=mv0>
Ubiquiti EdgePoint R6
</h1><a class="nowrap pl2" target=_ href=https://github.com/nycmeshnet/docs/blob/master/content/hardware/epr6.md>
<div class="ba b--light-gray br2 pa2 f6 fw5 black flex"><svg class="mr1 h1 db-ns dn" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
<span>Edit<span class="dn di-ns pre"> on GitHub</span></span>
</div></a>
</div><div class=f5>
<div class=f6>
<p>
Last updated
November 7, 2021 by danielhmetro
</p></div><p>The EP-R6 is an outdoor rooftop switch/router with 6 ports (5 GigE, 1 SFP). It supports PoE, but only Ubiquiti&rsquo;s 24v Passive PoE style, not any of the fancier types.</p><p>It can be configured in switch mode (just a switch, with a management console) or routing mode (hub node setup, BGP, etc).</p><p><img src=../../img/hardware/ubiquity_edgepointr6_front.png alt="Ubiquity EdgePoint R6 Front View"></p><p><img src=../../img/hardware/ubiquity_edgepointr6_ports.png alt="Ubiquity EdgePoint R6 Ports"></p><p>Device specs are available at <a href=https://store.ubnt.com/products/edgepoint-r6>store.ubnt.com</a>.</p><h2 id=reset>Reset</h2><p>To factory reset an EP-R6, press and hold the reset button, by the ethernet plugs, for about 10 seconds until the eth4 LED begins to flash, then release the button. The device will reboot and reset.</p><p>Or, reset it via the CLI by running the following commands:</p><pre tabindex=0><code>sudo cp /opt/vyatta/etc/config.boot.default /config/config.boot
reboot 
</code></pre><h2 id=connecting>Connecting</h2><p>The EP-R6 has a Web GUI and CLI.<br>
The initial IP address out of the box is 192.168.1.1, the Web GUI is at https://192.168.1.1
Set you computer&rsquo;s local IP to something similar ( 192.168.1.5 ), and connect to switch on port <em>eth0</em>.</p><p>Although there is a Web GUI, using SSH can allow for a much more rapid workflow. If possible, use that.<br>
Here is an example of SSHing to the EdgePoint when it is in factory default mode:</p><pre tabindex=0><code>laptop$ ssh -o StrictHostKeyChecking=no ubnt@192.168.1.1
Welcome to EdgeOS
...

ubnt@192.168.1.1&#39;s password: ubnt
Linux ubnt 3.10.14-UBNT #1 SMP Wed Nov 11 14:42:04 PST 2015 mips
Welcome to EdgeOS
ubnt@ubnt:~$
</code></pre><p>From here you can apply commands such as the ones below.</p><h2 id=device-idiosyncrasies>Device idiosyncrasies</h2><h1 id=hardware-nat>Hardware NAT</h1><p>If using the device as a router in NAT mode ( not router on the mesh ), the default settings will yield a very slow connection.<br>
Hardware NAT should be enabled, which was just possible as of firmware version v1.9.7.<br>
This page at Ubnt discusses more: <a href=https://help.ubnt.com/hc/en-us/articles/115006567467-EdgeRouter-Hardware-Offloading-Explained>https://help.ubnt.com/hc/en-us/articles/115006567467-EdgeRouter-Hardware-Offloading-Explained</a></p><p>To enable hardware offload on this model, perform the following commands on the CLI:</p><pre tabindex=0><code>configure
set system offload hwnat enable
commit
save
exit
</code></pre><h2 id=wireguard-vpn>Wireguard VPN</h2><p>coming</p><h2 id=switched-mode>Switched Mode</h2><p>To convert the EP-R6 to switched mode, there&rsquo;s now a <a href=https://help.ui.com/hc/en-us/articles/217990978-EdgeRouter-Configure-an-EdgeRouter-as-a-Layer-2-Switch#1>simple wizard</a> in the GUI to help.</p><h3 id=extend-an-omnitik>Extend an OmniTik</h3><p>A common use case for the EP-R6 as a switch is to add more PoE-capable ports to an OmniTik router on the roof. In order to preserve isolation between these ports and on the OmniTik, we need to make the switch <strong>VLAN-Aware</strong>. The following instructions assume the OmniTik has been configured with the <a href="https://configgen.nycmesh.net/?device=Omnitik5AC&template=rooftop-ospf.rsc.tmpl">standard configuration</a> and IP allocations.</p><p><strong>1. Start the Wizard</strong></p><p>In the web interface, navigate to the &ldquo;Wizards&rdquo; tab on the top right of the screen. On the left sidebar, click &ldquo;Switch&rdquo;.
Choose Static IP. You are probably connected directly to the switch right now, so you don&rsquo;t want to lose access to it while there&rsquo;s no DHCP server!</p><p>Log into the OmniTik you are planning on connecting the switch to; we are going to find an unused IP in its /26 subnet. On the left sidebar under IP->DHCP Server, click the &ldquo;Leases&rdquo; tab, and hit &ldquo;Add New&rdquo;. Type in the address you are allocating, <strong>uncheck</strong> &ldquo;Enabled&rdquo;, and type <code>nycmesh-xxxx-epr6</code> in the &ldquo;Comment&rdquo; (where <code>xxxx</code> is the network number to which this will be attached).</p><p>Type this address into the switch with a /26 subnet with the OmniTik&rsquo;s /26 IP Address as the gateway. Use <code>10.10.10.10</code> as the DNS server.</p><p><strong>2. Set the VLANs on the EP-R6</strong></p><p>Under &ldquo;VLAN Aware&rdquo;, check &ldquo;Enabled&rdquo;. Depending on which port will be connected to the OmniTik (the &ldquo;trunk&rdquo; port), you will set the VLANs using a combination of the OmniTik&rsquo;s and the EP-R6&rsquo;s port numbers.</p><p><em>Example:</em> EP-R6 is plugged into Port 3 on the OmniTik, and we want to isolate Ports 1-5 on the EP-R6.</p><pre tabindex=0><code>eth0: vid 301,302,303,304,305
eth1: pvid 301
eth2: pvid 303
eth3: pvid 303
eth4: pvid 304
eth5: pvid 305
</code></pre><p>In layman&rsquo;s terms, The PVID tags the port and VID tells where to send the tagged traffic out. The first digit will be the port number of the OmniTik, and the last digit will be the port number of the EP-R6. After setting up your credentials you can hit apply and reboot the router.</p><p><strong>3. Add the VLANs to the OmniTik</strong></p><p>Because eth0 did not have a PVID set, you should be able to access the switch using its new IP address without additional hardware. However, we need to configure the OmniTik to <em>receive</em> the tagged traffic and add them to the mesh bridge.</p><p>On the OmniTik, navigate to Interfaces on the left sidebar. Click Add New->VLAN for each port on the EP-R6 we are configuring. Let&rsquo;s use the EP-R6 <code>eth1</code> from above as our example:</p><pre tabindex=0><code>Name: ether1.301
VLAN ID: 301
Interface: ether3
</code></pre><p>Hit OK to save. Once you do this for each port on the EP-R6, you can navigate to the left sidebar and go to Bridge. Under the &ldquo;Ports&rdquo; tab, click &ldquo;Add New&rdquo; for each VLAN you are configuring. Select the Interface you just created (<code>ether1.301</code>) and the Bridge <code>mesh</code>. Hit OK, and do this for each VLAN interface.</p><p><strong>4. Test it!</strong></p><p>The easiest way to test your configuration is by connecting a DHCP client (like a router) to the port and testing traffic flow. Plug it into any of the configured ports of the EP-R6, where you will see the port turn purple, orange, or green on the top of the EP-R6&rsquo;s GUI (purple:10Mbps, orange:100Mbps, green:1G).</p><p>In the left sidebar of the OmniTik, under IP->DHCP Server, click on the &ldquo;Leases&rdquo; tab and check that it got an IP. Lastly, under Interfaces, check if traffic is visible on that particular VLAN. If you can see activity on that interface, you did it! ðŸŽ‰</p><h2 id=routed-mode--nycmesh-hub-node---bgp->Routed Mode ( NYCMesh Hub Node - BGP )</h2><p>You will need to know the following to be able to continue:
BGP ASN - Autonomous System Number within the network
Gateway Node Y/N - Are we going to be a gateway exit node
Peers ASN and IP - What are our Peer ASN and IP that we will connect with
Local Subnet - What local network will we have? One? Many?</p><p>Configuration:
The following sections below may be used in-part or in-whole depending on the need:</p><ul>
<li>Route Filters / Prefix list - Allows or denies certain ranges from the network. Good for ensuring functionality
<ul>
<li>The current filter set for NYCMesh can be found at <a href=../../network/filter>Filter</a></li></ul></li><li></li></ul><p>Example Parameters:
ASN: 65012
Gateway: N
Peer ASN: 65010
Peer IP: 10.180.14.1
Local Subnet: 10.70.50.0/24</p><pre tabindex=0><code>configure

## Filters ##
set policy prefix-list nycmeshprefixes rule 10 prefix 10.0.0.0/8
set policy prefix-list nycmeshprefixes rule 10 ge 22
set policy prefix-list nycmeshprefixes rule 10 le 32
set policy prefix-list nycmeshprefixes rule 10 action permit

set policy prefix-list nycmeshprefixes rule 20 prefix 172.16.0.0/12
set policy prefix-list nycmeshprefixes rule 20 ge 24
set policy prefix-list nycmeshprefixes rule 20 le 32
set policy prefix-list nycmeshprefixes rule 20 action permit

set policy prefix-list defaultroute rule 10 prefix 0.0.0.0/0
set policy prefix-list defaultroute rule 10 action permit

set policy route-map nycmeshroutes rule 10 action permit
set policy route-map nycmeshroutes rule 10 match ip address prefix-list nycmeshprefixes

# BGP Config
set protocols bgp 65012
set protocols bgp 65012 neighbor 10.180.14.1 remote-as 65010
set protocols bgp 65012 neighbor 10.180.14.1 soft-reconfiguration inbound
set protocols bgp 65012 neighbor 10.180.14.1 nexthop-self
set protocols bgp 65012 neighbor 10.180.14.1 route-map import nycmeshroutes
set protocols bgp 65012 neighbor 10.180.14.1 route-map export nycmeshroutes

# BGP Network Config
set protocols bgp 65012 network 10.70.50.0/24
set protocols static route 10.70.50.0/24 blackhole

# Save and Reset BGP
commit
save
clear ip bgp all
</code></pre></div></div></div></main></div></div></body></html>